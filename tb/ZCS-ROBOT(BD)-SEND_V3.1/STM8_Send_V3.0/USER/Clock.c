/******************************************************************************/
/*					                                      */
/*	Project Name :	发射机		                                      */
/*	Version      :	1.0			                              */
/*	MCU          :	ST 8-bit STM8S104K4T6C	                              */
/*	Clock        :	16MHz			                              */
/*	Author	     :	mengzhuozhuo   		                              */
/*      Date	     :	2016/04/26	                                      */
/*	Corporation  :	中惠创智（深圳）无线供电技术有限公司                   */
/*						                              */
/******************************************************************************/
/*******************************************************************************
-----------------------------     File start    --------------------------------
*******************************************************************************/


/*******************************************************************************
-----------------------------    Include files   -------------------------------
*******************************************************************************/
#include "type_def.h"
#include "Clock.h"
#include "uart.h"
#include "delayTime.h"
//******************************************************************************
//时钟函数
//******************************************************************************
void Clock(void)//时间
{
//***********************************************

//***********************************************
//上电2秒后开始工作   
    if(Flag_10ms_K ==1)
    {
        Flag_10ms_K =0;
        CNT_T2s++;
        if(CNT_T2s >= 50)
        {
            CNT_T2s =0;
            Flag_Mac_On2s = 1;
        }
    }
//***********************************************
//500ms读取一次串口数据，如果没法送数据则不能读取成功20170301 
    if(Flag_10ms_I == 1)
    {
        Flag_10ms_I =0;
        if(MacStatus == C_MSNORMAL)
        {
            CNT_T500ms++;
            //if((CNT_T500ms >= 50) && UART2_SR_RXNE)
			if(CNT_T500ms >= 10)
            {
				_delay_us(5);
                UART_Process();
                CNT_T500ms =0;
                //UART2_SR_RXNE = 0;
            }
        }
    }
//***********************************************
//保密功能计时1小时
    if(Flag_10ms_G == 1)
    {
        Flag_10ms_G =0;
        CNT_T1min++;
        if(CNT_T1min >= 6000)
        {
            CNT_T1min =0;
            CNT_T1hour++;
            if(CNT_T1hour >= 60)
            {
                CNT_T1hour =0;
                Flag_1hour_A =1;
				if(Flag_RestartEhours == 1)
				{
					flag_p = 6; //每隔一小时停止喂狗，系统重启
					Flag_RestartEhours = 0;
				}
            }
        }
    }    
}

/*******************************************************************************
-----------------------------    End of file    --------------------------------
*******************************************************************************/